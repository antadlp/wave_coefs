import re
import sys

#The purpose of this script is to get the potential energy on every frame of
#the the molecular dynamic generated by deMon2k
#http://www.demon-software.com/public_html/program.html 

def searchAndPrintOut(inputFile, outputFile):

    F = open(inputFile,'r')
    #The input file is the general output of the software package deMon2k
    #http://www.demon-software.com/public_html/program.html 

    fileOut = open(outputFile, "w")
    #The ouput file will be an array of energies

    step = 1 #Equivalent to the first step on the water dynamic
    for line in F:
        print(step)
        if "COORDINATES OF TIME STEP" in line:
            fileOut.write('    30') 
            fileOut.write('\n')
            # 30 is the total number of atmos, as we are training/testing with 10
            # waters molecules they are 30 atoms.
            k=1 #is the counter for the index of every atom
            j=1 #counter for a constant empty lines
            fileOut.write('molec    step    ')
            fileOut.write('{}'.format(step))
            fileOut.write('\n')
            for j in range(4):#empty constant lines
                line = next(F)
            
            #positioned on line for atom 1 (counter k=1). Example for step 1:
            # 1  H        3.137918      0.417859     -0.908692       1     1.008

            for k in range(30): 
                fileOut.write(line.split()[1]) #get the atom index, i.e: H or O
                fileOut.write('     ')
                fileOut.write(line.split()[2]) #get x coordinate
                fileOut.write('   ')
                fileOut.write(line.split()[3]) #get y coordinate
                fileOut.write('   ')
                fileOut.write(line.split()[4]) #get z coordinate
                fileOut.write('\n')
                line=next(F)                   #jump to next atom

            step += 1 #when this loops ends, the outside loop search for the
                      #next step on the dynamic that's why step+=1


    fileOut.close()
    F.close()
    
    return;


searchAndPrintOut('../../data/deMon.out', 'geometries.xyz')




